"use strict";

var _config = _interopRequireDefault(require("@apollosproject/config"));

var _dataSource = _interopRequireDefault(require("../data-source"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const buildGetMock = (response, dataSource) => {
  const get = jest.fn();

  if (Array.isArray(response) && Array.isArray(response[0])) {
    response.forEach(responseVal => {
      get.mockReturnValueOnce(new Promise(resolve => resolve(dataSource.normalize(responseVal))));
    });
  }

  get.mockReturnValue(new Promise(resolve => resolve(dataSource.normalize(response))));
  return get;
};

_config.default.loadJs({
  ROCK: {
    API_URL: 'https://apollosrock.newspring.cc/api',
    API_TOKEN: 'some-rock-token',
    IMAGE_URL: 'https://apollosrock.newspring.cc/GetImage.ashx'
  }
});

const auth = dataSource => ({
  getCurrentPerson: buildGetMock({
    Id: 51,
    FirstName: 'Vincent',
    LastName: 'Wilson'
  }, dataSource)
});

describe('Person', () => {
  it('constructs', () => {
    expect(new _dataSource.default()).toBeTruthy();
  });
  it('gets person from email', () => {
    const dataSource = new _dataSource.default();
    dataSource.get = buildGetMock({
      Email: 'isaac.hardy@newspring.cc'
    }, dataSource);
    const result = dataSource.getFromEmail('isaac.hardy@newspring.cc');
    expect(result).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('gets person from id', () => {
    const dataSource = new _dataSource.default();
    dataSource.get = buildGetMock({
      Id: 51
    }, dataSource);
    const result = dataSource.getFromId(51);
    expect(result).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it("updates a user's profile attributes", () => {
    const dataSource = new _dataSource.default();
    const Auth = auth(dataSource);
    dataSource.context = {
      rockCookie: 'fakeCookie',
      dataSource: {
        Auth
      }
    };
    dataSource.patch = buildGetMock({}, dataSource);
    const result = dataSource.updateProfile([{
      field: 'FirstName',
      value: 'Nick'
    }]);
    expect(result).resolves.toMatchSnapshot();
    expect(Auth.getCurrentPerson.mock.calls).toMatchSnapshot();
    expect(dataSource.patch.mock.calls).toMatchSnapshot();
  });
  it("uploads a user's profile picture", async () => {
    const dataSource = new _dataSource.default();
    dataSource.context = {
      rockCookie: 'fakeCookie'
    };
    dataSource.updateProfile = buildGetMock({
      Id: 51,
      FirstName: 'Vincent',
      LastName: 'Wilson'
    }, dataSource);
    dataSource.nodeFetch = buildGetMock({
      text: () => '245'
    }, dataSource);
    const result = await dataSource.uploadProfileImage({
      stream: '123'
    }, 456);
    expect(result).toMatchSnapshot();
    const nodeFetchCalls = dataSource.nodeFetch.mock.calls; // Remove randomly generated multipart boundary.

    nodeFetchCalls[0][1].body._boundary = nodeFetchCalls[0][1].body._boundary.replace(/\d+/, '');
    nodeFetchCalls[0][1].body._streams[0] = nodeFetchCalls[0][1].body._streams[0].replace(/\d+/, '');
    nodeFetchCalls[0][1].headers['content-type'] = nodeFetchCalls[0][1].headers['content-type'].replace(/\d+/, '');
    expect(nodeFetchCalls).toMatchSnapshot();
    expect(dataSource.updateProfile.mock.calls).toMatchSnapshot({});
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wZW9wbGUvX190ZXN0c19fL2RhdGEtc291cmNlLnRlc3RzLmpzIl0sIm5hbWVzIjpbImJ1aWxkR2V0TW9jayIsInJlc3BvbnNlIiwiZGF0YVNvdXJjZSIsImdldCIsImplc3QiLCJmbiIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJyZXNwb25zZVZhbCIsIm1vY2tSZXR1cm5WYWx1ZU9uY2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsIm5vcm1hbGl6ZSIsIm1vY2tSZXR1cm5WYWx1ZSIsIkFwb2xsb3NDb25maWciLCJsb2FkSnMiLCJST0NLIiwiQVBJX1VSTCIsIkFQSV9UT0tFTiIsIklNQUdFX1VSTCIsImF1dGgiLCJnZXRDdXJyZW50UGVyc29uIiwiSWQiLCJGaXJzdE5hbWUiLCJMYXN0TmFtZSIsImRlc2NyaWJlIiwiaXQiLCJleHBlY3QiLCJQZXJzb24iLCJ0b0JlVHJ1dGh5IiwiRW1haWwiLCJyZXN1bHQiLCJnZXRGcm9tRW1haWwiLCJyZXNvbHZlcyIsInRvTWF0Y2hTbmFwc2hvdCIsIm1vY2siLCJjYWxscyIsImdldEZyb21JZCIsIkF1dGgiLCJjb250ZXh0Iiwicm9ja0Nvb2tpZSIsInBhdGNoIiwidXBkYXRlUHJvZmlsZSIsImZpZWxkIiwidmFsdWUiLCJub2RlRmV0Y2giLCJ0ZXh0IiwidXBsb2FkUHJvZmlsZUltYWdlIiwic3RyZWFtIiwibm9kZUZldGNoQ2FsbHMiLCJib2R5IiwiX2JvdW5kYXJ5IiwicmVwbGFjZSIsIl9zdHJlYW1zIiwiaGVhZGVycyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7OztBQUVBLE1BQU1BLFlBQVksR0FBRyxDQUFDQyxRQUFELEVBQVdDLFVBQVgsS0FBMEI7QUFDN0MsUUFBTUMsR0FBRyxHQUFHQyxJQUFJLENBQUNDLEVBQUwsRUFBWjs7QUFDQSxNQUFJQyxLQUFLLENBQUNDLE9BQU4sQ0FBY04sUUFBZCxLQUEyQkssS0FBSyxDQUFDQyxPQUFOLENBQWNOLFFBQVEsQ0FBQyxD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QThCQyxLQUEvQixDQUFOLENBQTRDRixlQUE1QyxDQUE0RCxFQUE1RDtBQUNELEdBMUJDLENBQUY7QUEyQkQsQ0FyRU8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBcG9sbG9zQ29uZmlnIGZyb20gJ0BhcG9sbG9zcHJvamVjdC9jb25maWcnO1xuaW1wb3J0IFBlcnNvbiBmcm9tICcuLi9kYXRhLXNvdXJjZSc7XG5cbmNvbnN0IGJ1aWxkR2V0TW9jayA9IChyZXNwb25zZSwgZGF0YVNvdXJjZSkgPT4ge1xuICBjb25zdCBnZXQgPSBqZXN0LmZuKCk7XG4gIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlKSAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlWzBdKSkge1xuICAgIHJlc3BvbnNlLmZvckVhY2goKHJlc3BvbnNlVmFsKSA9PiB7XG4gICAgICBnZXQubW9ja1JldHVyblZhbHVlT25jZShcbiAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHJlc29sdmUoZGF0YVNvdXJjZS5ub3JtYWxpemUocmVzcG9uc2VWYWwpKSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cbiAgZ2V0Lm1vY2tSZXR1cm5WYWx1ZShcbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gcmVzb2x2ZShkYXRhU291cmNlLm5vcm1hbGl6ZShyZXNwb25zZSkpKVxuICApO1xuICByZXR1cm4gZ2V0O1xufTtcbkFwb2xsb3NDb25maWcubG9hZEpzKHtcbiAgUk9DSzoge1xuICAgIEFQSV9VUkw6ICdodHRwczovL2Fwb2xsb3Nyb2NrLm5ld3NwcmluZy5jYy9hcGknLFxuICAgIEFQSV9UT0tFTjogJ3NvbWUtcm9jay10b2tlbicsXG4gICAgSU1BR0VfVVJMOiAnaHR0cHM6Ly9hcG9sbG9zcm9jay5uZXdzcHJpbmcuY2MvR2V0SW1hZ2UuYXNoeCcsXG4gIH0sXG59KTtcblxuY29uc3QgYXV0aCA9IChkYXRhU291cmNlKSA9PiAoe1xuICBnZXRDdXJyZW50UGVyc29uOiBidWlsZEdldE1vY2soXG4gICAgeyBJZDogNTEsIEZpcnN0TmFtZTogJ1ZpbmNlbnQnLCBMYXN0TmFtZTogJ1dpbHNvbicgfSxcbiAgICBkYXRhU291cmNlXG4gICksXG59KTtcbmRlc2NyaWJlKCdQZXJzb24nLCAoKSA9PiB7XG4gIGl0KCdjb25zdHJ1Y3RzJywgKCkgPT4ge1xuICAgIGV4cGVjdChuZXcgUGVyc29uKCkpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG4gIGl0KCdnZXRzIHBlcnNvbiBmcm9tIGVtYWlsJywgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgUGVyc29uKCk7XG4gICAgZGF0YVNvdXJjZS5nZXQgPSBidWlsZEdldE1vY2soXG4gICAgICB7IEVtYWlsOiAnaXNhYWMuaGFyZHlAbmV3c3ByaW5nLmNjJyB9LFxuICAgICAgZGF0YVNvdXJjZVxuICAgICk7XG4gICAgY29uc3QgcmVzdWx0ID0gZGF0YVNvdXJjZS5nZXRGcm9tRW1haWwoJ2lzYWFjLmhhcmR5QG5ld3NwcmluZy5jYycpO1xuICAgIGV4cGVjdChyZXN1bHQpLnJlc29sdmVzLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIGV4cGVjdChkYXRhU291cmNlLmdldC5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgfSk7XG5cbiAgaXQoJ2dldHMgcGVyc29uIGZyb20gaWQnLCAoKSA9PiB7XG4gICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBQZXJzb24oKTtcbiAgICBkYXRhU291cmNlLmdldCA9IGJ1aWxkR2V0TW9jayh7IElkOiA1MSB9LCBkYXRhU291cmNlKTtcbiAgICBjb25zdCByZXN1bHQgPSBkYXRhU291cmNlLmdldEZyb21JZCg1MSk7XG4gICAgZXhwZWN0KHJlc3VsdCkucmVzb2x2ZXMudG9NYXRjaFNuYXBzaG90KCk7XG4gICAgZXhwZWN0KGRhdGFTb3VyY2UuZ2V0Lm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBpdChcInVwZGF0ZXMgYSB1c2VyJ3MgcHJvZmlsZSBhdHRyaWJ1dGVzXCIsICgpID0+IHtcbiAgICBjb25zdCBkYXRhU291cmNlID0gbmV3IFBlcnNvbigpO1xuICAgIGNvbnN0IEF1dGggPSBhdXRoKGRhdGFTb3VyY2UpO1xuICAgIGRhdGFTb3VyY2UuY29udGV4dCA9IHtcbiAgICAgIHJvY2tDb29raWU6ICdmYWtlQ29va2llJyxcbiAgICAgIGRhdGFTb3VyY2U6IHsgQXV0aCB9LFxuICAgIH07XG4gICAgZGF0YVNvdXJjZS5wYXRjaCA9IGJ1aWxkR2V0TW9jayh7fSwgZGF0YVNvdXJjZSk7XG4gICAgY29uc3QgcmVzdWx0ID0gZGF0YVNvdXJjZS51cGRhdGVQcm9maWxlKFtcbiAgICAgIHtcbiAgICAgICAgZmllbGQ6ICdGaXJzdE5hbWUnLFxuICAgICAgICB2YWx1ZTogJ05pY2snLFxuICAgICAgfSxcbiAgICBdKTtcbiAgICBleHBlY3QocmVzdWx0KS5yZXNvbHZlcy50b01hdGNoU25hcHNob3QoKTtcbiAgICBleHBlY3QoQXV0aC5nZXRDdXJyZW50UGVyc29uLm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIGV4cGVjdChkYXRhU291cmNlLnBhdGNoLm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBpdChcInVwbG9hZHMgYSB1c2VyJ3MgcHJvZmlsZSBwaWN0dXJlXCIsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBkYXRhU291cmNlID0gbmV3IFBlcnNvbigpO1xuICAgIGRhdGFTb3VyY2UuY29udGV4dCA9IHsgcm9ja0Nvb2tpZTogJ2Zha2VDb29raWUnIH07XG4gICAgZGF0YVNvdXJjZS51cGRhdGVQcm9maWxlID0gYnVpbGRHZXRNb2NrKFxuICAgICAgeyBJZDogNTEsIEZpcnN0TmFtZTogJ1ZpbmNlbnQnLCBMYXN0TmFtZTogJ1dpbHNvbicgfSxcbiAgICAgIGRhdGFTb3VyY2VcbiAgICApO1xuICAgIGRhdGFTb3VyY2Uubm9kZUZldGNoID0gYnVpbGRHZXRNb2NrKHsgdGV4dDogKCkgPT4gJzI0NScgfSwgZGF0YVNvdXJjZSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhU291cmNlLnVwbG9hZFByb2ZpbGVJbWFnZSh7IHN0cmVhbTogJzEyMycgfSwgNDU2KTtcbiAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICBjb25zdCBub2RlRmV0Y2hDYWxscyA9IGRhdGFTb3VyY2Uubm9kZUZldGNoLm1vY2suY2FsbHM7XG4gICAgLy8gUmVtb3ZlIHJhbmRvbWx5IGdlbmVyYXRlZCBtdWx0aXBhcnQgYm91bmRhcnkuXG4gICAgbm9kZUZldGNoQ2FsbHNbMF1bMV0uYm9keS5fYm91bmRhcnkgPSBub2RlRmV0Y2hDYWxsc1swXVsxXS5ib2R5Ll9ib3VuZGFyeS5yZXBsYWNlKFxuICAgICAgL1xcZCsvLFxuICAgICAgJydcbiAgICApO1xuICAgIG5vZGVGZXRjaENhbGxzWzBdWzFdLmJvZHkuX3N0cmVhbXNbMF0gPSBub2RlRmV0Y2hDYWxsc1swXVsxXS5ib2R5Ll9zdHJlYW1zWzBdLnJlcGxhY2UoXG4gICAgICAvXFxkKy8sXG4gICAgICAnJ1xuICAgICk7XG4gICAgbm9kZUZldGNoQ2FsbHNbMF1bMV0uaGVhZGVyc1snY29udGVudC10eXBlJ10gPSBub2RlRmV0Y2hDYWxsc1swXVsxXS5oZWFkZXJzW1xuICAgICAgJ2NvbnRlbnQtdHlwZSdcbiAgICBdLnJlcGxhY2UoL1xcZCsvLCAnJyk7XG4gICAgZXhwZWN0KG5vZGVGZXRjaENhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgICBleHBlY3QoZGF0YVNvdXJjZS51cGRhdGVQcm9maWxlLm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCh7fSk7XG4gIH0pO1xufSk7XG4iXX0=