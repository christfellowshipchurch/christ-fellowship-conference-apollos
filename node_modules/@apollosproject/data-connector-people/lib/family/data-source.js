"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _rockApolloDataSource = _interopRequireDefault(require("@apollosproject/rock-apollo-data-source"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class Family extends _rockApolloDataSource.default {
  constructor(...args) {
    super(...args);

    _defineProperty(this, "resource", 'Family');
  }

  getFamily({
    userId
  }) {
    if (!userId) {
      throw new Error('UserID is required to fetch a family');
    }

    return this.request(`/Groups/GetFamilies/${userId}`);
  }

  async getFamilyLocation({
    userId
  }) {
    const familyReq = await this.getFamily({
      userId
    }).expand('GroupLocations,Campus,GroupLocations/Location').get();
    if (familyReq.length === 0) return null;
    const family = familyReq[0]; // First option - a user's address city/state.

    if (family.groupLocations.length && family.groupLocations[0].location) {
      const {
        location
      } = family.groupLocations[0];
      return `${location.city}, ${location.state}`;
    } // Second option - their campus name


    if (family.campus) {
      return family.campus.name;
    }

    return null;
  }

}

exports.default = Family;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mYW1pbHkvZGF0YS1zb3VyY2UuanMiXSwibmFtZXMiOlsiRmFtaWx5IiwiUm9ja0Fwb2xsb0RhdGFTb3VyY2UiLCJnZXRGYW1pbHkiLCJ1c2VySWQiLCJFcnJvciIsInJlcXVlc3QiLCJnZXRGYW1pbHlMb2NhdGlvbiIsImZhbWlseVJlcSIsImV4cGFuZCIsImdldCIsImxlbmd0aCIsImZhbWlseSIsImdyb3VwTG9jYXRpb25zIiwibG9jYXRpb24iLCJjaXR5Iiwic3RhdGUiLCJjYW1wdXMiLCJuYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7OztBQUVlLE1BQU1BLE1BQU4sU0FBcUJDLDZCQUFyQixDQUEwQztBQUFBO0FBQUE7O0FBQUEsc0NBQzVDLFFBRDRDO0FBQUE7O0FBR3ZEQyxFQUFBQSxTQUFTLENBQUM7QUFBRUMsSUFBQUE7QUFBRixHQUFELEVBQWE7QUFDcEIsUUFBSSxDQUFDQSxNQUFMLEVBQWE7QUFDWCxZQUFNLElBQUlDLEtBQUosQ0FBVSxzQ0FBVixDQUFOO0FBQ0Q7O0FBQ0QsV0FBTyxLQUFLQyxPQUFMLENBQWMsdUJBQXNCRixNQUFPLEVBQTNDLENBQVA7QUFDRDs7QUFFRCxRQUFNRyxpQkFBTixDQUF3QjtBQUFFSCxJQUFBQTtBQUFGLEdBQXhCLEVBQW9DO0FBQ2xDLFVBQU1JLFNBQVMsR0FBRyxNQUFNLEtBQUtMLFNBQUwsQ0FBZTtBQUFFQyxNQUFBQTtBQUFGLEtBQWYsRUFDckJLLE1BRHFCLENBQ2QsK0NBRGMsRUFFckJDLEdBRnFCLEVBQXhCO0FBSUEsUUFBSUYsU0FBUyxDQUFDRyxNQUFWLEtBQXFCLENBQXpCLEVBQTRCLE9BQU8sSUFBUDtBQUU1QixVQUFNQyxNQUFNLEdBQUdKLFNBQVMsQ0FBQyxDQUFELENBQXhCLENBUGtDLENBUWxDOztBQUNBLFFBQUlJLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkYsTUFBdEIsSUFBZ0NDLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQixDQUF0QixFQUF5QkMsUUFBN0QsRUFBdUU7QUFDckUsWUFBTTtBQUFFQSxRQUFBQTtBQUFGLFVBQWVGLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQixDQUF0QixDQUFyQjtBQUNBLGFBQVEsR0FBRUMsUUFBUSxDQUFDQyxJQUFLLEtBQUlELFFBQVEsQ0FBQ0UsS0FBTSxFQUEzQztBQUNELEtBWmlDLENBY2xDOzs7QUFDQSxRQUFJSixNQUFNLENBQUNLLE1BQVgsRUFBbUI7QUFDakIsYUFBT0wsTUFBTSxDQUFDSyxNQUFQLENBQWNDLElBQXJCO0FBQ0Q7O0FBRUQsV0FBTyxJQUFQO0FBQ0Q7O0FBOUJzRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSb2NrQXBvbGxvRGF0YVNvdXJjZSBmcm9tICdAYXBvbGxvc3Byb2plY3Qvcm9jay1hcG9sbG8tZGF0YS1zb3VyY2UnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGYW1pbHkgZXh0ZW5kcyBSb2NrQXBvbGxvRGF0YVNvdXJjZSB7XG4gIHJlc291cmNlID0gJ0ZhbWlseSc7XG5cbiAgZ2V0RmFtaWx5KHsgdXNlcklkIH0pIHtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VySUQgaXMgcmVxdWlyZWQgdG8gZmV0Y2ggYSBmYW1pbHknKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgL0dyb3Vwcy9HZXRGYW1pbGllcy8ke3VzZXJJZH1gKTtcbiAgfVxuXG4gIGFzeW5jIGdldEZhbWlseUxvY2F0aW9uKHsgdXNlcklkIH0pIHtcbiAgICBjb25zdCBmYW1pbHlSZXEgPSBhd2FpdCB0aGlzLmdldEZhbWlseSh7IHVzZXJJZCB9KVxuICAgICAgLmV4cGFuZCgnR3JvdXBMb2NhdGlvbnMsQ2FtcHVzLEdyb3VwTG9jYXRpb25zL0xvY2F0aW9uJylcbiAgICAgIC5nZXQoKTtcblxuICAgIGlmIChmYW1pbHlSZXEubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDtcblxuICAgIGNvbnN0IGZhbWlseSA9IGZhbWlseVJlcVswXTtcbiAgICAvLyBGaXJzdCBvcHRpb24gLSBhIHVzZXIncyBhZGRyZXNzIGNpdHkvc3RhdGUuXG4gICAgaWYgKGZhbWlseS5ncm91cExvY2F0aW9ucy5sZW5ndGggJiYgZmFtaWx5Lmdyb3VwTG9jYXRpb25zWzBdLmxvY2F0aW9uKSB7XG4gICAgICBjb25zdCB7IGxvY2F0aW9uIH0gPSBmYW1pbHkuZ3JvdXBMb2NhdGlvbnNbMF07XG4gICAgICByZXR1cm4gYCR7bG9jYXRpb24uY2l0eX0sICR7bG9jYXRpb24uc3RhdGV9YDtcbiAgICB9XG5cbiAgICAvLyBTZWNvbmQgb3B0aW9uIC0gdGhlaXIgY2FtcHVzIG5hbWVcbiAgICBpZiAoZmFtaWx5LmNhbXB1cykge1xuICAgICAgcmV0dXJuIGZhbWlseS5jYW1wdXMubmFtZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuIl19