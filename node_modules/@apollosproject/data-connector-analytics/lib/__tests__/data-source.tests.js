"use strict";

var _universalAnalytics = require("universal-analytics");

var _analyticsNode = _interopRequireWildcard(require("analytics-node"));

var _apolloServer = require("apollo-server");

var _config = _interopRequireDefault(require("@apollosproject/config"));

var _dataSource = _interopRequireDefault(require("../data-source"));

var _rock_interactions = _interopRequireDefault(require("../interfaces/rock_interactions"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

const mockCurrentPerson = jest.fn().mockImplementation(() => ({
  id: 5,
  email: 'test@test.com',
  firstName: 'Rick',
  lastName: 'Hampton'
}));

const mockNoPerson = () => {
  throw new _apolloServer.AuthenticationError();
};

const mockOtherError = () => {
  throw new Error('Some other error');
};

const clearMocks = () => {
  [_universalAnalytics.mockUA, _universalAnalytics.mockSend, _universalAnalytics.mockEvent, _analyticsNode.default, _analyticsNode.mockTrack, _analyticsNode.mockIdentify].forEach(mock => {
    mock.mockClear();
  });
};

const AuthWithUser = {
  getCurrentPerson: mockCurrentPerson
};
const AuthWithoutUser = {
  getCurrentPerson: mockNoPerson
};

const buildDataSource = (Auth = AuthWithUser) => {
  const dataSource = new _dataSource.default();
  dataSource.initialize({
    context: {
      dataSources: {
        Auth
      }
    }
  });
  return dataSource;
};

describe('Analytics Data Source', () => {
  beforeEach(() => {
    clearMocks();
    const ANALYTICS = {
      SEGMENT_KEY: 'something',
      GA_ID: 'something-else'
    };

    _config.default.loadJs({
      ANALYTICS
    });
  });
  afterEach(() => {
    _config.default.loadJs({
      ANALYTICS: {
        SEGMENT_KEY: null,
        GA_ID: null
      }
    });
  });
  it('must accept arbitrary interfaces', async () => {
    const track = jest.fn();
    const identify = jest.fn();
    const fakeClient = {
      track,
      identify,
      shouldTrack: true,
      shouldIdentify: true,
      eventWhitelist: null,
      initialize: () => ({})
    };
    const dataSource = new _dataSource.default([fakeClient]);
    dataSource.initialize({
      context: {
        dataSources: {
          Auth: AuthWithUser
        }
      }
    });
    const resultTrack = await dataSource.track({
      anonymousId: 'deviceId5',
      eventName: 'View Content'
    });
    const resultIdentify = await dataSource.identify({
      anonymousId: 'deviceId5'
    });
    expect(resultTrack).toMatchSnapshot();
    expect(track).toHaveBeenCalledTimes(1);
    expect(track).toMatchSnapshot();
    expect(resultIdentify).toMatchSnapshot();
    expect(identify).toHaveBeenCalledTimes(1);
    expect(identify).toMatchSnapshot();
  });
  describe('track', () => {
    it('must track specific events using the Rock adapter', async () => {
      const rockAnalytics = new _rock_interactions.default();
      const dataSource = new _dataSource.default([rockAnalytics]);
      const mockCreateInteraction = jest.fn();
      dataSource.initialize({
        context: {
          sessionId: 'Session:123',
          dataSources: {
            Auth: AuthWithUser,
            Interactions: {
              createContentItemInteraction: mockCreateInteraction
            }
          }
        }
      });
      const result = await dataSource.track({
        eventName: 'View Content',
        properties: [{
          field: 'itemId',
          value: 'Content:123'
        }, {
          field: 'title',
          value: 'Super Cool Content'
        }]
      });
      expect(result).toMatchSnapshot();
      expect(mockCreateInteraction).toHaveBeenCalledTimes(1);
      expect(mockCreateInteraction.mock.calls).toMatchSnapshot();
    });
    it('must not track events using the Rock adapter without required attrs', async () => {
      const rockAnalytics = new _rock_interactions.default();
      const dataSource = new _dataSource.default([rockAnalytics]);
      const mockCreateInteraction = jest.fn();
      dataSource.initialize({
        context: {
          dataSources: {
            Auth: AuthWithUser,
            Interactions: {
              createInteraction: mockCreateInteraction
            }
          }
        }
      }); // Without session id.

      await dataSource.track({
        eventName: 'View Content',
        properties: [{
          field: 'SessionId',
          value: 'Session:123'
        }]
      });
      expect(mockCreateInteraction).toHaveBeenCalledTimes(0); // Without content id.

      await dataSource.track({
        eventName: 'View Content',
        properties: [{
          field: 'ContentId',
          value: 'Content:123'
        }]
      });
      expect(mockCreateInteraction).toHaveBeenCalledTimes(0); // without a current user

      dataSource.context.dataSources.Auth = AuthWithoutUser;
      await dataSource.track({
        eventName: 'View Content',
        properties: [{
          field: 'ContentId',
          value: 'Content:123'
        }, {
          field: 'SessionId',
          value: 'Session:123'
        }]
      });
      expect(mockCreateInteraction).toHaveBeenCalledTimes(0);
      dataSource.context.dataSources.Auth = AuthWithUser; // With an unhandled event

      rockAnalytics.eventWhitelist = ['Some Event'];
      await dataSource.track({
        eventName: 'Some Event',
        properties: [{
          field: 'ContentId',
          value: 'Content:123'
        }, {
          field: 'SessionId',
          value: 'Session:123'
        }]
      });
      expect(mockCreateInteraction).toHaveBeenCalledTimes(0);
    });
    it('must track an event with a name and no properties', async () => {
      const analytics = buildDataSource();
      const result = await analytics.track({
        eventName: 'View Content',
        anonymousId: 'deviceId5'
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockTrack).toHaveBeenCalledTimes(1);
      expect(_analyticsNode.mockTrack.mock.calls).toMatchSnapshot();
      expect(_universalAnalytics.mockSend).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA.mock.calls).toMatchSnapshot();
    });
    it('must not track segment without a key', async () => {
      _config.default.loadJs({
        ANALYTICS: {
          GA_ID: 'something-else',
          SEGMENT_KEY: null
        }
      });

      const analytics = buildDataSource();
      const result = await analytics.track({
        eventName: 'View Content'
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockTrack).toHaveBeenCalledTimes(0);
      expect(_universalAnalytics.mockSend).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA.mock.calls).toMatchSnapshot();
    });
    it('must not track google analytics without a key', async () => {
      _config.default.loadJs({
        ANALYTICS: {
          SEGMENT_KEY: 'something',
          GA_ID: null
        }
      });

      const analytics = buildDataSource();
      const result = await analytics.track({
        eventName: 'View Content'
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockTrack).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockSend).toHaveBeenCalledTimes(0);
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(0);
    });
    it('must track an event with a name and properties', async () => {
      const analytics = buildDataSource();
      const result = await analytics.track({
        eventName: 'View Content',
        anonymousId: 'deviceId5',
        properties: [{
          field: 'ContentId',
          value: 7
        }]
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockTrack).toHaveBeenCalledTimes(1);
      expect(_analyticsNode.mockTrack.mock.calls).toMatchSnapshot();
      expect(_universalAnalytics.mockSend).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA.mock.calls).toMatchSnapshot();
    });
    it('must track without a user', async () => {
      const analytics = buildDataSource(AuthWithoutUser);
      const result = await analytics.track({
        eventName: 'View Content'
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockTrack).toHaveBeenCalledTimes(1);
      expect(_analyticsNode.mockTrack.mock.calls).toMatchSnapshot();
      expect(_universalAnalytics.mockSend).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(1);
      expect(_universalAnalytics.mockUA.mock.calls).toMatchSnapshot();
    });
    it('must reraise a non-auth Error', () => {
      const analytics = buildDataSource({
        getCurrentPerson: mockOtherError
      });
      const result = analytics.track({
        eventName: 'View Content'
      });
      expect(result).rejects.toThrow();
      expect(_universalAnalytics.mockSend).toHaveBeenCalledTimes(0);
      expect(_analyticsNode.mockTrack).toHaveBeenCalledTimes(0);
    });
  });
  describe('identify', () => {
    it('must identify a user without traits', async () => {
      const analytics = buildDataSource();
      const result = await analytics.identify({
        anonymousId: 'deviceId5'
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockIdentify).toHaveBeenCalledTimes(1);
      expect(_analyticsNode.mockIdentify.mock.calls).toMatchSnapshot();
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(0);
    });
    it('must identify a user with traits', async () => {
      const analytics = buildDataSource();
      const result = await analytics.identify({
        anonymousId: 'deviceId5',
        traits: [{
          field: 'ChurchRole',
          value: 'Pastor'
        }]
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockIdentify).toHaveBeenCalledTimes(1);
      expect(_analyticsNode.mockIdentify.mock.calls).toMatchSnapshot();
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(0);
    });
    it('must identify a user with device info', async () => {
      const analytics = buildDataSource();
      const result = await analytics.identify({
        anonymousId: 'deviceId5',
        deviceInfo: {
          platform: 'iOS',
          deviceId: 'gibberish',
          deviceMode: 'Latest iPhone',
          appVersion: '72.0.1'
        }
      });
      expect(result).toMatchSnapshot();
      expect(_analyticsNode.mockIdentify).toHaveBeenCalledTimes(1);
      expect(_analyticsNode.mockIdentify.mock.calls).toMatchSnapshot();
      expect(_universalAnalytics.mockUA).toHaveBeenCalledTimes(0);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9fX3Rlc3RzX18vZGF0YS1zb3VyY2UudGVzdHMuanMiXSwibmFtZXMiOlsibW9ja0N1cnJlbnRQZXJzb24iLCJqZXN0IiwiZm4iLCJtb2NrSW1wbGVtZW50YXRpb24iLCJpZCIsImVtYWlsIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJtb2NrTm9QZXJzb24iLCJBdXRoZW50aWNhdGlvbkVycm9yIiwibW9ja090aGVyRXJyb3IiLCJFcnJvciIsImNsZWFyTW9ja3MiLCJtb2NrVUEiLCJtb2NrU2VuZCIsIm1vY2tFdmVudCIsIkFuYWx5dGljcyIsIm1vY2tUcmFjayIsIm1vY2tJZGVudGlmeSIsImZvckVhY2giLCJtb2NrIiwibW9ja0NsZWFyIiwiQXV0aFdpdGhVc2VyIiwiZ2V0Q3VycmVudFBlcnNvbiIsIkF1dGhXaXRob3V0VXNlciIsImJ1aWxkRGF0YVNvdXJjZSIsIkF1dGgiLCJkYXRhU291cmNlIiwiRGF0YVNvdXJjZSIsImluaXRpYWxpemUiLCJjb250ZXh0IiwiZGF0YVNvdXJjZXMiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJBTkFMWVRJQ1MiLCJTRUdNRU5UX0tFWSIsIkdBX0lEIiwiQXBvbGxvc0NvbmZpZyIsImxvYWRKcyIsImFmdGVyRWFjaCIsIml0IiwidHJhY2siLCJpZGVudGlmeSIsImZha2VDbGllbnQiLCJzaG91bGRUcmFjayIsInNob3VsZElkZW50aWZ5IiwiZXZlbnRXaGl0ZWxpc3QiLCJyZXN1bHRUcmFjayIsImFub255bW91c0lkIiwiZXZlbnROYW1lIiwicmVzdWx0SWRlbnRpZnkiLCJleHBlY3QiLCJ0b01hdGNoU25hcHNob3QiLCJ0b0hhdmVCZWVuQ2FsbGVkVGltZXMiLCJyb2NrQW5hbHl0aWNzIiwiUm9ja0FuYWx5dGljcyIsIm1vY2tDcmVhdGVJbnRlcmFjdGlvbiIsInNlc3Npb25JZCIsIkludGVyYWN0aW9ucyIsImNyZWF0ZUNvbnRlbnRJdGVtSW50ZXJhY3Rpb24iLCJyZXN1bHQiLCJwcm9wZXJ0aWVzIiwiZmllbGQiLCJ2YWx1ZSIsImNhbGxzIiwiY3JlYXRlSW50ZXJhY3Rpb24iLCJhbmFseXRpY3MiLCJyZWplY3RzIiwidG9UaHJvdyIsInRyYWl0cyIsImRldmljZUluZm8iLCJwbGF0Zm9ybSIsImRldmljZUlkIiwiZGV2aWNlTW9kZSIsImFwcFZlcnNpb24iXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLE1BQU1BLGlCQUFpQixHQUFHQyxJQUFJLENBQUNDLEVBQUwsR0FBVUMsa0JBQVYsQ0FBNkIsT0FBTztBQUM1REMsRUFBQUEsRUFBRSxFQUFFLENBRHdEO0FBRTVEQyxFQUFBQSxLQUFLLEVBQUUsZUFGcUQ7QUFHNURDLEVBQUFBLFNBQVMsRUFBRSxNQUhpRDtBQUk1REMsRUFBQUEsUUFBUSxFQUFFO0FBSmtELENBQVAsQ0FBN0IsQ0FBMUI7O0FBT0EsTUFBTUMsWUFBWSxHQUFHLE1BQU07QUFDekIsUUFBTSxJQUFJQyxpQ0FBSixFQUFOO0FBQ0QsQ0FGRDs7QUFHQSxNQUFNQyxjQUFjLEdBQUcsTUFBTTtBQUMzQixRQUFNLElBQUlDLEtBQUosQ0FBVSxrQkFBVixDQUFOO0FBQ0QsQ0FGRDs7QUFJQSxNQUFNQyxVQUFVLEdBQUcsTUFBTTtBQUN2QixHQUFDQywwQkFBRCxFQUFTQyw0QkFBVCxFQUFtQkMsNkJBQW5CLEVBQThCQyxzQkFBOUIsRUFBeUNDLHdCQUF6QyxFQUFvREMsMkJBQXBELEVBQWtFQyxPQUFsRSxDQUNHQyxJQUFELElBQVU7QUFDUkEsSUFBQUEsSUFBSSxDQUFDQyxTQUFMO0FBQ0QsR0FISDtBQUtELENBTkQ7O0FBUUEsTUFBTUMsWUFBWSxHQUFHO0FBQ25CQyxFQUFBQSxnQkFBZ0IsRUFBRXZCO0FBREMsQ0FBckI7QUFJQSxNQUFNd0IsZUFBZSxHQUFHO0FBQ3RCRCxFQUFBQSxnQkFBZ0IsRUFBRWY7QUFESSxDQUF4Qjs7QUFJQSxNQUFNaUIsZUFBZSxHQUFHLENBQUNDLElBQUksR0FBR0osWUFBUixLQUF5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QWlCRCxHQXpDTyxDQUFSO0FBMENELENBbFFPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtb2NrVUEsIG1vY2tTZW5kLCBtb2NrRXZlbnQgfSBmcm9tICd1bml2ZXJzYWwtYW5hbHl0aWNzJztcbmltcG9ydCBBbmFseXRpY3MsIHsgbW9ja1RyYWNrLCBtb2NrSWRlbnRpZnkgfSBmcm9tICdhbmFseXRpY3Mtbm9kZSc7XG5pbXBvcnQgeyBBdXRoZW50aWNhdGlvbkVycm9yIH0gZnJvbSAnYXBvbGxvLXNlcnZlcic7XG5pbXBvcnQgQXBvbGxvc0NvbmZpZyBmcm9tICdAYXBvbGxvc3Byb2plY3QvY29uZmlnJztcbmltcG9ydCBEYXRhU291cmNlIGZyb20gJy4uL2RhdGEtc291cmNlJztcbmltcG9ydCBSb2NrQW5hbHl0aWNzIGZyb20gJy4uL2ludGVyZmFjZXMvcm9ja19pbnRlcmFjdGlvbnMnO1xuXG5jb25zdCBtb2NrQ3VycmVudFBlcnNvbiA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgaWQ6IDUsXG4gIGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsXG4gIGZpcnN0TmFtZTogJ1JpY2snLFxuICBsYXN0TmFtZTogJ0hhbXB0b24nLFxufSkpO1xuXG5jb25zdCBtb2NrTm9QZXJzb24gPSAoKSA9PiB7XG4gIHRocm93IG5ldyBBdXRoZW50aWNhdGlvbkVycm9yKCk7XG59O1xuY29uc3QgbW9ja090aGVyRXJyb3IgPSAoKSA9PiB7XG4gIHRocm93IG5ldyBFcnJvcignU29tZSBvdGhlciBlcnJvcicpO1xufTtcblxuY29uc3QgY2xlYXJNb2NrcyA9ICgpID0+IHtcbiAgW21vY2tVQSwgbW9ja1NlbmQsIG1vY2tFdmVudCwgQW5hbHl0aWNzLCBtb2NrVHJhY2ssIG1vY2tJZGVudGlmeV0uZm9yRWFjaChcbiAgICAobW9jaykgPT4ge1xuICAgICAgbW9jay5tb2NrQ2xlYXIoKTtcbiAgICB9XG4gICk7XG59O1xuXG5jb25zdCBBdXRoV2l0aFVzZXIgPSB7XG4gIGdldEN1cnJlbnRQZXJzb246IG1vY2tDdXJyZW50UGVyc29uLFxufTtcblxuY29uc3QgQXV0aFdpdGhvdXRVc2VyID0ge1xuICBnZXRDdXJyZW50UGVyc29uOiBtb2NrTm9QZXJzb24sXG59O1xuXG5jb25zdCBidWlsZERhdGFTb3VyY2UgPSAoQXV0aCA9IEF1dGhXaXRoVXNlcikgPT4ge1xuICBjb25zdCBkYXRhU291cmNlID0gbmV3IERhdGFTb3VyY2UoKTtcbiAgZGF0YVNvdXJjZS5pbml0aWFsaXplKHsgY29udGV4dDogeyBkYXRhU291cmNlczogeyBBdXRoIH0gfSB9KTtcbiAgcmV0dXJuIGRhdGFTb3VyY2U7XG59O1xuXG5kZXNjcmliZSgnQW5hbHl0aWNzIERhdGEgU291cmNlJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjbGVhck1vY2tzKCk7XG4gICAgY29uc3QgQU5BTFlUSUNTID0geyBTRUdNRU5UX0tFWTogJ3NvbWV0aGluZycsIEdBX0lEOiAnc29tZXRoaW5nLWVsc2UnIH07XG4gICAgQXBvbGxvc0NvbmZpZy5sb2FkSnMoeyBBTkFMWVRJQ1MgfSk7XG4gIH0pO1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIEFwb2xsb3NDb25maWcubG9hZEpzKHsgQU5BTFlUSUNTOiB7IFNFR01FTlRfS0VZOiBudWxsLCBHQV9JRDogbnVsbCB9IH0pO1xuICB9KTtcblxuICBpdCgnbXVzdCBhY2NlcHQgYXJiaXRyYXJ5IGludGVyZmFjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdHJhY2sgPSBqZXN0LmZuKCk7XG4gICAgY29uc3QgaWRlbnRpZnkgPSBqZXN0LmZuKCk7XG4gICAgY29uc3QgZmFrZUNsaWVudCA9IHtcbiAgICAgIHRyYWNrLFxuICAgICAgaWRlbnRpZnksXG4gICAgICBzaG91bGRUcmFjazogdHJ1ZSxcbiAgICAgIHNob3VsZElkZW50aWZ5OiB0cnVlLFxuICAgICAgZXZlbnRXaGl0ZWxpc3Q6IG51bGwsXG4gICAgICBpbml0aWFsaXplOiAoKSA9PiAoe30pLFxuICAgIH07XG4gICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBEYXRhU291cmNlKFtmYWtlQ2xpZW50XSk7XG4gICAgZGF0YVNvdXJjZS5pbml0aWFsaXplKHsgY29udGV4dDogeyBkYXRhU291cmNlczogeyBBdXRoOiBBdXRoV2l0aFVzZXIgfSB9IH0pO1xuXG4gICAgY29uc3QgcmVzdWx0VHJhY2sgPSBhd2FpdCBkYXRhU291cmNlLnRyYWNrKHtcbiAgICAgIGFub255bW91c0lkOiAnZGV2aWNlSWQ1JyxcbiAgICAgIGV2ZW50TmFtZTogJ1ZpZXcgQ29udGVudCcsXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXN1bHRJZGVudGlmeSA9IGF3YWl0IGRhdGFTb3VyY2UuaWRlbnRpZnkoe1xuICAgICAgYW5vbnltb3VzSWQ6ICdkZXZpY2VJZDUnLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHJlc3VsdFRyYWNrKS50b01hdGNoU25hcHNob3QoKTtcbiAgICBleHBlY3QodHJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QodHJhY2spLnRvTWF0Y2hTbmFwc2hvdCgpO1xuXG4gICAgZXhwZWN0KHJlc3VsdElkZW50aWZ5KS50b01hdGNoU25hcHNob3QoKTtcbiAgICBleHBlY3QoaWRlbnRpZnkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QoaWRlbnRpZnkpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndHJhY2snLCAoKSA9PiB7XG4gICAgaXQoJ211c3QgdHJhY2sgc3BlY2lmaWMgZXZlbnRzIHVzaW5nIHRoZSBSb2NrIGFkYXB0ZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByb2NrQW5hbHl0aWNzID0gbmV3IFJvY2tBbmFseXRpY3MoKTtcbiAgICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgRGF0YVNvdXJjZShbcm9ja0FuYWx5dGljc10pO1xuICAgICAgY29uc3QgbW9ja0NyZWF0ZUludGVyYWN0aW9uID0gamVzdC5mbigpO1xuICAgICAgZGF0YVNvdXJjZS5pbml0aWFsaXplKHtcbiAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgIHNlc3Npb25JZDogJ1Nlc3Npb246MTIzJyxcbiAgICAgICAgICBkYXRhU291cmNlczoge1xuICAgICAgICAgICAgQXV0aDogQXV0aFdpdGhVc2VyLFxuICAgICAgICAgICAgSW50ZXJhY3Rpb25zOiB7XG4gICAgICAgICAgICAgIGNyZWF0ZUNvbnRlbnRJdGVtSW50ZXJhY3Rpb246IG1vY2tDcmVhdGVJbnRlcmFjdGlvbixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYXRhU291cmNlLnRyYWNrKHtcbiAgICAgICAgZXZlbnROYW1lOiAnVmlldyBDb250ZW50JyxcbiAgICAgICAgcHJvcGVydGllczogW1xuICAgICAgICAgIHsgZmllbGQ6ICdpdGVtSWQnLCB2YWx1ZTogJ0NvbnRlbnQ6MTIzJyB9LFxuICAgICAgICAgIHsgZmllbGQ6ICd0aXRsZScsIHZhbHVlOiAnU3VwZXIgQ29vbCBDb250ZW50JyB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgICAgZXhwZWN0KG1vY2tDcmVhdGVJbnRlcmFjdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tDcmVhdGVJbnRlcmFjdGlvbi5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgICB9KTtcbiAgICBpdCgnbXVzdCBub3QgdHJhY2sgZXZlbnRzIHVzaW5nIHRoZSBSb2NrIGFkYXB0ZXIgd2l0aG91dCByZXF1aXJlZCBhdHRycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJvY2tBbmFseXRpY3MgPSBuZXcgUm9ja0FuYWx5dGljcygpO1xuICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBEYXRhU291cmNlKFtyb2NrQW5hbHl0aWNzXSk7XG4gICAgICBjb25zdCBtb2NrQ3JlYXRlSW50ZXJhY3Rpb24gPSBqZXN0LmZuKCk7XG4gICAgICBkYXRhU291cmNlLmluaXRpYWxpemUoe1xuICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgZGF0YVNvdXJjZXM6IHtcbiAgICAgICAgICAgIEF1dGg6IEF1dGhXaXRoVXNlcixcbiAgICAgICAgICAgIEludGVyYWN0aW9uczoge1xuICAgICAgICAgICAgICBjcmVhdGVJbnRlcmFjdGlvbjogbW9ja0NyZWF0ZUludGVyYWN0aW9uLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFdpdGhvdXQgc2Vzc2lvbiBpZC5cbiAgICAgIGF3YWl0IGRhdGFTb3VyY2UudHJhY2soe1xuICAgICAgICBldmVudE5hbWU6ICdWaWV3IENvbnRlbnQnLFxuICAgICAgICBwcm9wZXJ0aWVzOiBbeyBmaWVsZDogJ1Nlc3Npb25JZCcsIHZhbHVlOiAnU2Vzc2lvbjoxMjMnIH1dLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ3JlYXRlSW50ZXJhY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcblxuICAgICAgLy8gV2l0aG91dCBjb250ZW50IGlkLlxuICAgICAgYXdhaXQgZGF0YVNvdXJjZS50cmFjayh7XG4gICAgICAgIGV2ZW50TmFtZTogJ1ZpZXcgQ29udGVudCcsXG4gICAgICAgIHByb3BlcnRpZXM6IFt7IGZpZWxkOiAnQ29udGVudElkJywgdmFsdWU6ICdDb250ZW50OjEyMycgfV0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tDcmVhdGVJbnRlcmFjdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuXG4gICAgICAvLyB3aXRob3V0IGEgY3VycmVudCB1c2VyXG4gICAgICBkYXRhU291cmNlLmNvbnRleHQuZGF0YVNvdXJjZXMuQXV0aCA9IEF1dGhXaXRob3V0VXNlcjtcbiAgICAgIGF3YWl0IGRhdGFTb3VyY2UudHJhY2soe1xuICAgICAgICBldmVudE5hbWU6ICdWaWV3IENvbnRlbnQnLFxuICAgICAgICBwcm9wZXJ0aWVzOiBbXG4gICAgICAgICAgeyBmaWVsZDogJ0NvbnRlbnRJZCcsIHZhbHVlOiAnQ29udGVudDoxMjMnIH0sXG4gICAgICAgICAgeyBmaWVsZDogJ1Nlc3Npb25JZCcsIHZhbHVlOiAnU2Vzc2lvbjoxMjMnIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tDcmVhdGVJbnRlcmFjdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuICAgICAgZGF0YVNvdXJjZS5jb250ZXh0LmRhdGFTb3VyY2VzLkF1dGggPSBBdXRoV2l0aFVzZXI7XG5cbiAgICAgIC8vIFdpdGggYW4gdW5oYW5kbGVkIGV2ZW50XG4gICAgICByb2NrQW5hbHl0aWNzLmV2ZW50V2hpdGVsaXN0ID0gWydTb21lIEV2ZW50J107XG5cbiAgICAgIGF3YWl0IGRhdGFTb3VyY2UudHJhY2soe1xuICAgICAgICBldmVudE5hbWU6ICdTb21lIEV2ZW50JyxcbiAgICAgICAgcHJvcGVydGllczogW1xuICAgICAgICAgIHsgZmllbGQ6ICdDb250ZW50SWQnLCB2YWx1ZTogJ0NvbnRlbnQ6MTIzJyB9LFxuICAgICAgICAgIHsgZmllbGQ6ICdTZXNzaW9uSWQnLCB2YWx1ZTogJ1Nlc3Npb246MTIzJyB9LFxuICAgICAgICBdLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ3JlYXRlSW50ZXJhY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgICB9KTtcbiAgICBpdCgnbXVzdCB0cmFjayBhbiBldmVudCB3aXRoIGEgbmFtZSBhbmQgbm8gcHJvcGVydGllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFuYWx5dGljcyA9IGJ1aWxkRGF0YVNvdXJjZSgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5hbHl0aWNzLnRyYWNrKHtcbiAgICAgICAgZXZlbnROYW1lOiAnVmlldyBDb250ZW50JyxcbiAgICAgICAgYW5vbnltb3VzSWQ6ICdkZXZpY2VJZDUnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2subW9jay5jYWxscykudG9NYXRjaFNuYXBzaG90KCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tVQSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tVQS5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgICB9KTtcblxuICAgIGl0KCdtdXN0IG5vdCB0cmFjayBzZWdtZW50IHdpdGhvdXQgYSBrZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBBcG9sbG9zQ29uZmlnLmxvYWRKcyh7XG4gICAgICAgIEFOQUxZVElDUzogeyBHQV9JRDogJ3NvbWV0aGluZy1lbHNlJywgU0VHTUVOVF9LRVk6IG51bGwgfSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYW5hbHl0aWNzID0gYnVpbGREYXRhU291cmNlKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhbmFseXRpY3MudHJhY2soe1xuICAgICAgICBldmVudE5hbWU6ICdWaWV3IENvbnRlbnQnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcblxuICAgICAgZXhwZWN0KG1vY2tTZW5kKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja1VBKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja1VBLm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ211c3Qgbm90IHRyYWNrIGdvb2dsZSBhbmFseXRpY3Mgd2l0aG91dCBhIGtleScsIGFzeW5jICgpID0+IHtcbiAgICAgIEFwb2xsb3NDb25maWcubG9hZEpzKHtcbiAgICAgICAgQU5BTFlUSUNTOiB7IFNFR01FTlRfS0VZOiAnc29tZXRoaW5nJywgR0FfSUQ6IG51bGwgfSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYW5hbHl0aWNzID0gYnVpbGREYXRhU291cmNlKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhbmFseXRpY3MudHJhY2soe1xuICAgICAgICBldmVudE5hbWU6ICdWaWV3IENvbnRlbnQnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcblxuICAgICAgZXhwZWN0KG1vY2tTZW5kKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gICAgICBleHBlY3QobW9ja1VBKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnbXVzdCB0cmFjayBhbiBldmVudCB3aXRoIGEgbmFtZSBhbmQgcHJvcGVydGllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFuYWx5dGljcyA9IGJ1aWxkRGF0YVNvdXJjZSgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5hbHl0aWNzLnRyYWNrKHtcbiAgICAgICAgZXZlbnROYW1lOiAnVmlldyBDb250ZW50JyxcbiAgICAgICAgYW5vbnltb3VzSWQ6ICdkZXZpY2VJZDUnLFxuICAgICAgICBwcm9wZXJ0aWVzOiBbeyBmaWVsZDogJ0NvbnRlbnRJZCcsIHZhbHVlOiA3IH1dLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2subW9jay5jYWxscykudG9NYXRjaFNuYXBzaG90KCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tVQSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tVQS5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgICB9KTtcblxuICAgIGl0KCdtdXN0IHRyYWNrIHdpdGhvdXQgYSB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYW5hbHl0aWNzID0gYnVpbGREYXRhU291cmNlKEF1dGhXaXRob3V0VXNlcik7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhbmFseXRpY3MudHJhY2soe1xuICAgICAgICBldmVudE5hbWU6ICdWaWV3IENvbnRlbnQnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChtb2NrVHJhY2subW9jay5jYWxscykudG9NYXRjaFNuYXBzaG90KCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tVQSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tVQS5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgICB9KTtcblxuICAgIGl0KCdtdXN0IHJlcmFpc2UgYSBub24tYXV0aCBFcnJvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGFuYWx5dGljcyA9IGJ1aWxkRGF0YVNvdXJjZSh7IGdldEN1cnJlbnRQZXJzb246IG1vY2tPdGhlckVycm9yIH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYW5hbHl0aWNzLnRyYWNrKHtcbiAgICAgICAgZXZlbnROYW1lOiAnVmlldyBDb250ZW50JyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkucmVqZWN0cy50b1Rocm93KCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuICAgICAgZXhwZWN0KG1vY2tUcmFjaykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaWRlbnRpZnknLCAoKSA9PiB7XG4gICAgaXQoJ211c3QgaWRlbnRpZnkgYSB1c2VyIHdpdGhvdXQgdHJhaXRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYW5hbHl0aWNzID0gYnVpbGREYXRhU291cmNlKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhbmFseXRpY3MuaWRlbnRpZnkoe1xuICAgICAgICBhbm9ueW1vdXNJZDogJ2RldmljZUlkNScsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgICAgZXhwZWN0KG1vY2tJZGVudGlmeSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tJZGVudGlmeS5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcblxuICAgICAgZXhwZWN0KG1vY2tVQSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuICAgIH0pO1xuICAgIGl0KCdtdXN0IGlkZW50aWZ5IGEgdXNlciB3aXRoIHRyYWl0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFuYWx5dGljcyA9IGJ1aWxkRGF0YVNvdXJjZSgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5hbHl0aWNzLmlkZW50aWZ5KHtcbiAgICAgICAgYW5vbnltb3VzSWQ6ICdkZXZpY2VJZDUnLFxuICAgICAgICB0cmFpdHM6IFt7IGZpZWxkOiAnQ2h1cmNoUm9sZScsIHZhbHVlOiAnUGFzdG9yJyB9XSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9NYXRjaFNuYXBzaG90KCk7XG4gICAgICBleHBlY3QobW9ja0lkZW50aWZ5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja0lkZW50aWZ5Lm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuXG4gICAgICBleHBlY3QobW9ja1VBKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMCk7XG4gICAgfSk7XG4gICAgaXQoJ211c3QgaWRlbnRpZnkgYSB1c2VyIHdpdGggZGV2aWNlIGluZm8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhbmFseXRpY3MgPSBidWlsZERhdGFTb3VyY2UoKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFuYWx5dGljcy5pZGVudGlmeSh7XG4gICAgICAgIGFub255bW91c0lkOiAnZGV2aWNlSWQ1JyxcbiAgICAgICAgZGV2aWNlSW5mbzoge1xuICAgICAgICAgIHBsYXRmb3JtOiAnaU9TJyxcbiAgICAgICAgICBkZXZpY2VJZDogJ2dpYmJlcmlzaCcsXG4gICAgICAgICAgZGV2aWNlTW9kZTogJ0xhdGVzdCBpUGhvbmUnLFxuICAgICAgICAgIGFwcFZlcnNpb246ICc3Mi4wLjEnLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoU25hcHNob3QoKTtcbiAgICAgIGV4cGVjdChtb2NrSWRlbnRpZnkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChtb2NrSWRlbnRpZnkubW9jay5jYWxscykudG9NYXRjaFNuYXBzaG90KCk7XG5cbiAgICAgIGV4cGVjdChtb2NrVUEpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==