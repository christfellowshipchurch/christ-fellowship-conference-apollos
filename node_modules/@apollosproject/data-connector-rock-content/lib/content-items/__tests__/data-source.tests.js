"use strict";

var _apolloServerEnv = require("apollo-server-env");

var _config = _interopRequireDefault(require("@apollosproject/config"));

var _testUtils = require("../../test-utils");

var _dataSource = _interopRequireDefault(require("../data-source"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_config.default.loadJs({
  ROCK: {
    API_URL: 'https://apollosrock.newspring.cc/api',
    API_TOKEN: 'some-rock-token',
    IMAGE_URL: 'https://apollosrock.newspring.cc/GetImage.ashx'
  }
});

describe('ContentItemsModel', () => {
  beforeEach(() => {
    _apolloServerEnv.fetch.resetMocks();
  });
  it('constructs', () => {
    expect(new _dataSource.default()).toBeTruthy();
  });
  it('filters by content channel id', () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([{
      Id: 1
    }, {
      Id: 2
    }], dataSource);
    const result = dataSource.byContentChannelId(1).get();
    expect(result).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('gets by id', () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)({
      Id: 1
    }, dataSource);
    const result = dataSource.getFromId(1);
    expect(result).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('gets a cursor finding child content items of a provided parent', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([[{
      ChildContentChannelItemId: 101
    }, {
      ChildContentChannelItemId: 201
    }], [{
      Id: 1
    }, {
      Id: 2
    }]], dataSource);
    const cursor = await dataSource.getCursorByParentContentItemId(1);
    expect(cursor.get()).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('returns null when there are no child content items', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([], dataSource);
    const cursor = await dataSource.getCursorByParentContentItemId(1);
    expect(cursor).toBe(null);
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('gets a cursor finding parent content items of a provided child', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([[{
      ContentChannelItemId: 101
    }, {
      ContentChannelItemId: 201
    }], [{
      Id: 1
    }, {
      Id: 2
    }]], dataSource);
    const cursor = await dataSource.getCursorByChildContentItemId(1);
    expect(cursor.get()).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('gets a cursor finding sibling content items of a provided item', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([[{
      ContentChannelItemId: 101
    }], [{
      ContentChannelId: 201,
      ChildContentChannelItemId: 1
    }, {
      ContentChannelId: 202,
      ChildContentChannelItemId: 2
    }], [{
      Id: 1
    }, {
      Id: 2
    }]], dataSource);
    const cursor = await dataSource.getCursorBySiblingContentItemId(1);
    expect(cursor.get()).resolves.toMatchSnapshot();
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
  it('returns null when there are no parent content items', async () => {
    const dataSource = new _dataSource.default();
    dataSource.get = (0, _testUtils.buildGetMock)([], dataSource);
    const cursor = await dataSource.getCursorByChildContentItemId(1);
    expect(cursor).toBe(null);
    expect(dataSource.get.mock.calls).toMatchSnapshot();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250ZW50LWl0ZW1zL19fdGVzdHNfXy9kYXRhLXNvdXJjZS50ZXN0cy5qcyJdLCJuYW1lcyI6WyJBcG9sbG9zQ29uZmlnIiwibG9hZEpzIiwiUk9DSyIsIkFQSV9VUkwiLCJBUElfVE9LRU4iLCJJTUFHRV9VUkwiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJmZXRjaCIsInJlc2V0TW9ja3MiLCJpdCIsImV4cGVjdCIsIkNvbnRlbnRJdGVtc0RhdGFTb3VyY2UiLCJ0b0JlVHJ1dGh5IiwiZGF0YVNvdXJjZSIsImdldCIsIklkIiwicmVzdWx0IiwiYnlDb250ZW50Q2hhbm5lbElkIiwicmVzb2x2ZXMiLCJ0b01hdGNoU25hcHNob3QiLCJtb2NrIiwiY2FsbHMiLCJnZXRGcm9tSWQiLCJDaGlsZENvbnRlbnRDaGFubmVsSXRlbUlkIiwiY3Vyc29yIiwiZ2V0Q3Vyc29yQnlQYXJlbnRDb250ZW50SXRlbUlkIiwidG9CZSIsIkNvbnRlbnRDaGFubmVsSXRlbUlkIiwiZ2V0Q3Vyc29yQnlDaGlsZENvbnRlbnRJdGVtSWQiLCJDb250ZW50Q2hhbm5lbElkIiwiZ2V0Q3Vyc29yQnlTaWJsaW5nQ29udGVudEl0ZW1JZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQTs7OztBQUVBQSxnQkFBY0MsTUFBZCxDQUFxQjtBQUNuQkMsRUFBQUEsSUFBSSxFQUFFO0FBQ0pDLElBQUFBLE9BQU8sRUFBRSxzQ0FETDtBQUVKQyxJQUFBQSxTQUFTLEVBQUUsaUJBRlA7QUFHSkMsSUFBQUEsU0FBUyxFQUFFO0FBSFA7QUFEYSxDQUFyQjs7QUFRQUMsUUFBUSxDQUFDLG1CQUFELEVBQXNCLE1BQU07QUFDbENDLEVBQUFBLFVBQVUsQ0FBQyxNQUFNO0FBQ2ZDLDJCQUFNQyxVQUFOO0FBQ0QsR0FGUyxDQUFWO0FBR0FDLEVBQUFBLEVBQUUsQ0FBQyxZQUFELEVBQWUsTUFBTTtBQUNyQkMsSUFBQUEsTUFBTSxDQUFDLElBQUlDLG1CQUFK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RTtBQUFOLEtBQVosQ0FORixDQURlLEVBU2ZGLFVBVGUsQ0FBakI7QUFXQSxVQUFNVyxNQUFNLEdBQUcsTUFBTVgsVUFBVSxDQUFDaUIsK0JBQVgsQ0FBMkMsQ0FBM0MsQ0FBckI7QUFDQXBCLElBQUFBLE1BQU0sQ0FBQ2MsTUFBTSxDQUFDVixHQUFQLEVBQUQsQ0FBTixDQUFxQkksUUFBckIsQ0FBOEJDLGVBQTlCO0FBQ0FULElBQUFBLE1BQU0sQ0FBQ0csVUFBVSxDQUFDQyxHQUFYLENBQWVNLElBQWYsQ0FBb0JDLEtBQXJCLENBQU4sQ0FBa0NGLGVBQWxDO0FBQ0QsR0FoQkMsQ0FBRjtBQWtCQVYsRUFBQUEsRUFBRSxDQUFDLHFEQUFELEVBQXdELFlBQVk7QUFDcEUsVUFBTUksVUFBVSxHQUFHLElBQUlGLG1CQUFKLEVBQW5CO0FBQ0FFLElBQUFBLFVBQVUsQ0FBQ0MsR0FBWCxHQUFpQiw2QkFBYSxFQUFiLEVBQWlCRCxVQUFqQixDQUFqQjtBQUNBLFVBQU1XLE1BQU0sR0FBRyxNQUFNWCxVQUFVLENBQUNlLDZCQUFYLENBQXlDLENBQXpDLENBQXJCO0FBQ0FsQixJQUFBQSxNQUFNLENBQUNjLE1BQUQsQ0FBTixDQUFlRSxJQUFmLENBQW9CLElBQXBCO0FBQ0FoQixJQUFBQSxNQUFNLENBQUNHLFVBQVUsQ0FBQ0MsR0FBWCxDQUFlTSxJQUFmLENBQW9CQyxLQUFyQixDQUFOLENBQWtDRixlQUFsQztBQUNELEdBTkMsQ0FBRjtBQU9ELENBdkZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmZXRjaCB9IGZyb20gJ2Fwb2xsby1zZXJ2ZXItZW52JztcbmltcG9ydCBBcG9sbG9zQ29uZmlnIGZyb20gJ0BhcG9sbG9zcHJvamVjdC9jb25maWcnO1xuaW1wb3J0IHsgYnVpbGRHZXRNb2NrIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscyc7XG5cbmltcG9ydCBDb250ZW50SXRlbXNEYXRhU291cmNlIGZyb20gJy4uL2RhdGEtc291cmNlJztcblxuQXBvbGxvc0NvbmZpZy5sb2FkSnMoe1xuICBST0NLOiB7XG4gICAgQVBJX1VSTDogJ2h0dHBzOi8vYXBvbGxvc3JvY2submV3c3ByaW5nLmNjL2FwaScsXG4gICAgQVBJX1RPS0VOOiAnc29tZS1yb2NrLXRva2VuJyxcbiAgICBJTUFHRV9VUkw6ICdodHRwczovL2Fwb2xsb3Nyb2NrLm5ld3NwcmluZy5jYy9HZXRJbWFnZS5hc2h4JyxcbiAgfSxcbn0pO1xuXG5kZXNjcmliZSgnQ29udGVudEl0ZW1zTW9kZWwnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGZldGNoLnJlc2V0TW9ja3MoKTtcbiAgfSk7XG4gIGl0KCdjb25zdHJ1Y3RzJywgKCkgPT4ge1xuICAgIGV4cGVjdChuZXcgQ29udGVudEl0ZW1zRGF0YVNvdXJjZSgpKS50b0JlVHJ1dGh5KCk7XG4gIH0pO1xuICBpdCgnZmlsdGVycyBieSBjb250ZW50IGNoYW5uZWwgaWQnLCAoKSA9PiB7XG4gICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBDb250ZW50SXRlbXNEYXRhU291cmNlKCk7XG4gICAgZGF0YVNvdXJjZS5nZXQgPSBidWlsZEdldE1vY2soW3sgSWQ6IDEgfSwgeyBJZDogMiB9XSwgZGF0YVNvdXJjZSk7XG4gICAgY29uc3QgcmVzdWx0ID0gZGF0YVNvdXJjZS5ieUNvbnRlbnRDaGFubmVsSWQoMSkuZ2V0KCk7XG4gICAgZXhwZWN0KHJlc3VsdCkucmVzb2x2ZXMudG9NYXRjaFNuYXBzaG90KCk7XG4gICAgZXhwZWN0KGRhdGFTb3VyY2UuZ2V0Lm1vY2suY2FsbHMpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBpdCgnZ2V0cyBieSBpZCcsICgpID0+IHtcbiAgICBjb25zdCBkYXRhU291cmNlID0gbmV3IENvbnRlbnRJdGVtc0RhdGFTb3VyY2UoKTtcbiAgICBkYXRhU291cmNlLmdldCA9IGJ1aWxkR2V0TW9jayh7IElkOiAxIH0sIGRhdGFTb3VyY2UpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGRhdGFTb3VyY2UuZ2V0RnJvbUlkKDEpO1xuICAgIGV4cGVjdChyZXN1bHQpLnJlc29sdmVzLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIGV4cGVjdChkYXRhU291cmNlLmdldC5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgfSk7XG5cbiAgaXQoJ2dldHMgYSBjdXJzb3IgZmluZGluZyBjaGlsZCBjb250ZW50IGl0ZW1zIG9mIGEgcHJvdmlkZWQgcGFyZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgQ29udGVudEl0ZW1zRGF0YVNvdXJjZSgpO1xuICAgIGRhdGFTb3VyY2UuZ2V0ID0gYnVpbGRHZXRNb2NrKFxuICAgICAgW1xuICAgICAgICBbXG4gICAgICAgICAgeyBDaGlsZENvbnRlbnRDaGFubmVsSXRlbUlkOiAxMDEgfSxcbiAgICAgICAgICB7IENoaWxkQ29udGVudENoYW5uZWxJdGVtSWQ6IDIwMSB9LFxuICAgICAgICBdLFxuICAgICAgICBbeyBJZDogMSB9LCB7IElkOiAyIH1dLFxuICAgICAgXSxcbiAgICAgIGRhdGFTb3VyY2VcbiAgICApO1xuICAgIGNvbnN0IGN1cnNvciA9IGF3YWl0IGRhdGFTb3VyY2UuZ2V0Q3Vyc29yQnlQYXJlbnRDb250ZW50SXRlbUlkKDEpO1xuICAgIGV4cGVjdChjdXJzb3IuZ2V0KCkpLnJlc29sdmVzLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIGV4cGVjdChkYXRhU291cmNlLmdldC5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgfSk7XG5cbiAgaXQoJ3JldHVybnMgbnVsbCB3aGVuIHRoZXJlIGFyZSBubyBjaGlsZCBjb250ZW50IGl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgQ29udGVudEl0ZW1zRGF0YVNvdXJjZSgpO1xuICAgIGRhdGFTb3VyY2UuZ2V0ID0gYnVpbGRHZXRNb2NrKFtdLCBkYXRhU291cmNlKTtcbiAgICBjb25zdCBjdXJzb3IgPSBhd2FpdCBkYXRhU291cmNlLmdldEN1cnNvckJ5UGFyZW50Q29udGVudEl0ZW1JZCgxKTtcbiAgICBleHBlY3QoY3Vyc29yKS50b0JlKG51bGwpO1xuICAgIGV4cGVjdChkYXRhU291cmNlLmdldC5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgfSk7XG5cbiAgaXQoJ2dldHMgYSBjdXJzb3IgZmluZGluZyBwYXJlbnQgY29udGVudCBpdGVtcyBvZiBhIHByb3ZpZGVkIGNoaWxkJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgQ29udGVudEl0ZW1zRGF0YVNvdXJjZSgpO1xuICAgIGRhdGFTb3VyY2UuZ2V0ID0gYnVpbGRHZXRNb2NrKFxuICAgICAgW1xuICAgICAgICBbeyBDb250ZW50Q2hhbm5lbEl0ZW1JZDogMTAxIH0sIHsgQ29udGVudENoYW5uZWxJdGVtSWQ6IDIwMSB9XSxcbiAgICAgICAgW3sgSWQ6IDEgfSwgeyBJZDogMiB9XSxcbiAgICAgIF0sXG4gICAgICBkYXRhU291cmNlXG4gICAgKTtcbiAgICBjb25zdCBjdXJzb3IgPSBhd2FpdCBkYXRhU291cmNlLmdldEN1cnNvckJ5Q2hpbGRDb250ZW50SXRlbUlkKDEpO1xuICAgIGV4cGVjdChjdXJzb3IuZ2V0KCkpLnJlc29sdmVzLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICAgIGV4cGVjdChkYXRhU291cmNlLmdldC5tb2NrLmNhbGxzKS50b01hdGNoU25hcHNob3QoKTtcbiAgfSk7XG5cbiAgaXQoJ2dldHMgYSBjdXJzb3IgZmluZGluZyBzaWJsaW5nIGNvbnRlbnQgaXRlbXMgb2YgYSBwcm92aWRlZCBpdGVtJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBuZXcgQ29udGVudEl0ZW1zRGF0YVNvdXJjZSgpO1xuICAgIGRhdGFTb3VyY2UuZ2V0ID0gYnVpbGRHZXRNb2NrKFxuICAgICAgW1xuICAgICAgICBbeyBDb250ZW50Q2hhbm5lbEl0ZW1JZDogMTAxIH1dLFxuICAgICAgICBbXG4gICAgICAgICAgeyBDb250ZW50Q2hhbm5lbElkOiAyMDEsIENoaWxkQ29udGVudENoYW5uZWxJdGVtSWQ6IDEgfSxcbiAgICAgICAgICB7IENvbnRlbnRDaGFubmVsSWQ6IDIwMiwgQ2hpbGRDb250ZW50Q2hhbm5lbEl0ZW1JZDogMiB9LFxuICAgICAgICBdLFxuICAgICAgICBbeyBJZDogMSB9LCB7IElkOiAyIH1dLFxuICAgICAgXSxcbiAgICAgIGRhdGFTb3VyY2VcbiAgICApO1xuICAgIGNvbnN0IGN1cnNvciA9IGF3YWl0IGRhdGFTb3VyY2UuZ2V0Q3Vyc29yQnlTaWJsaW5nQ29udGVudEl0ZW1JZCgxKTtcbiAgICBleHBlY3QoY3Vyc29yLmdldCgpKS5yZXNvbHZlcy50b01hdGNoU25hcHNob3QoKTtcbiAgICBleHBlY3QoZGF0YVNvdXJjZS5nZXQubW9jay5jYWxscykudG9NYXRjaFNuYXBzaG90KCk7XG4gIH0pO1xuXG4gIGl0KCdyZXR1cm5zIG51bGwgd2hlbiB0aGVyZSBhcmUgbm8gcGFyZW50IGNvbnRlbnQgaXRlbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZGF0YVNvdXJjZSA9IG5ldyBDb250ZW50SXRlbXNEYXRhU291cmNlKCk7XG4gICAgZGF0YVNvdXJjZS5nZXQgPSBidWlsZEdldE1vY2soW10sIGRhdGFTb3VyY2UpO1xuICAgIGNvbnN0IGN1cnNvciA9IGF3YWl0IGRhdGFTb3VyY2UuZ2V0Q3Vyc29yQnlDaGlsZENvbnRlbnRJdGVtSWQoMSk7XG4gICAgZXhwZWN0KGN1cnNvcikudG9CZShudWxsKTtcbiAgICBleHBlY3QoZGF0YVNvdXJjZS5nZXQubW9jay5jYWxscykudG9NYXRjaFNuYXBzaG90KCk7XG4gIH0pO1xufSk7XG4iXX0=